<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--During development turn off caching-->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title></title>
    <link rel="stylesheet" href="https://appsforoffice.microsoft.com/fabric/1.0/fabric.min.css">


    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/google-libphonenumber/3.2.27/libphonenumber.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/validator@latest/validator.min.js"></script>
   


    <script>
      const phoneUtil = libphonenumber.PhoneNumberUtil.getInstance();
        var newheader="";
        var currentheader="";
        var heeadercolor="";
        var vketJson="";
        var scopnename="";
        var classname="";
        var sensename="";
        var scopeindex=0;
        var scopeidindex="";
        var regxarray=[];
        var funcindex="";
        var poitika=[];
        var kural=[];
        var keywords=[];
        var classscore=[];
        var sensescore=[];
        var dialog;
        const JsonUrl="https://gokhanalpan.github.io";
        // The initialize function must be run each time a new page is loaded
        (function () {
            Office.initialize = function (reason) {
                //If you need to initialize something you can do so here.
        //  getJsonData();
          if(Office.context.document.settings.get("currentheader"))
          {
              currentheader=Office.context.document.settings.get("currentheader");
            //  ////console.log("instant "+currentheader);
          } else
          {
             Office.context.document.settings.set("currentheader",currentheader);
             Office.context.document.settings.saveAsync(function(asyncResult){});   
            // ////console.log("instant2 "+currentheader);

          }
          
            };
        })();

        //Notice function needs to be in global namespace
        function writeText(messagex,event) {

       //     Office.context.ui.displayDialogAsync('https://vket.azurewebsites.net/HTML/Scope.html', { height: 30, width: 20 });

            //Consult Office.js API reference to see all you can do. This just shows the simplest action.

            Office.context.document.setSelectedDataAsync(messagex,

                function (asyncResult) {
                    var error = asyncResult.error;
                    if (asyncResult.status === "failed") {
                        //show error. Upcoming displayDialog API will help here.
                    }
                    else {
                        //show success.Upcoming displayDialog API will help here.
                    }
                });
            //Required, call event.completed to let the platform know you are done processing.
          //  ////console.log("completed");
            event.completed();
           
        
        }
   async function getJsonData()
    {
      if(Office.context.document.settings.get("vket"))
      {
        vketJson=(Office.context.document.settings.get("vket"));
        //////console.log("vket varmış "+ vketJson);
//        await Office.context.document.setSelectedDataAsync("json alındı zaten"+vketJson);

      }
      else
      {
        let response = await fetch(JsonUrl+"/config.data");
        if  (response.ok)
          {
           vketJson = await response.json();
           Office.context.document.settings.set("vket",vketJson);
           await Office.context.document.settings.saveAsync(function(asyncResult){});
       // ////console.log("yeni json alındı "+vketJson);
  //        Office.context.document.setSelectedDataAsync("json alındı settings "+Office.context.document.settings.get("vket"));


     //load scopes to scopeList
  
     
          } else
          {
    console.error("http error : " + response.status);
          }
      }
  
}
  



        function yaz(event)
        {
           writeText("bunu yaz",event)
            
          event.completed();

            
        }
   
     async function addHeader() {
      await Word.run(async (context) => {
        ////console.log("addheader started");
     await readscope();
        
        ////console.log("readscope end");

        if(!Office.context.document.settings.get("sensename"))
        {
          ////console.log("sense name is null");
           Office.context.document.settings.set("sensename","Kişisel Veri İçermez");
           //Office.context.document.settings.refresh()
           Office.context.document.settings.saveAsync(function(asyncResult){}); 


        }
        ////console.log(" new sendename checked "+Office.context.document.settings.get("sensename"));
         newheader=Office.context.document.settings.get("scopename")+' | '+Office.context.document.settings.get("classname") +' | '+Office.context.document.settings.get("sensename");  
        ////console.log("ch1-sett "+Office.context.document.settings.get("currentheader"));
        
        ////console.log("ch1 var "+currentheader);
         //   ////console.log(newheader);

        ////console.log("currentscopeprop check started");
       if(!Office.context.document.settings.get("currentscopeprop"))
       {
        if(!Office.context.document.settings.get("currentheader"))
        {
          context.document.sections
          .getFirst()
          .getHeader("Primary")
          .insertHtml(newheader, "Start");

        Office.context.document.settings.set("currentheader",newheader);
        Office.context.document.settings.saveAsync(function(asyncResult){});
        ////console.log("ch2-sett "+Office.context.document.settings.get("currentheader"));
        ////console.log("ch2 var "+currentheader);
         

        await context.sync();
        }
      } else
      {
        currentheader=Office.context.document.settings.get("currentscopeprop")+' | '+Office.context.document.settings.get("currentclassprop")+' | '+Office.context.document.settings.get("currentsenseprop");
        Office.context.document.settings.set("currentheader",currentheader);
        Office.context.document.settings.saveAsync(function(asyncResult){}); 
        await context.sync();
        ////console.log("ch3-sett "+Office.context.document.settings.get("currentheader"));
        ////console.log("ch3 var "+currentheader);
        
      }
      ////console.log("search started sense:"+Office.context.document.settings.get("sensename"));
        var mysections = context.document.sections;
        context.load(mysections);

        await context.sync();
        currentheader=(Office.context.document.settings.get("currentheader"));
        ////console.log("ch4-sett "+Office.context.document.settings.get("currentheader"));
        ////console.log("ch4 var "+currentheader);
        
        
       // ////console.log("CURRENT HEADER: "+(Office.context.document.settings.get("currentheader")));
        for (var ii = 0; ii < mysections.items.length; ii++) {
          ////console.log("sections loop");
          ////console.log("section length :"+ mysections.items.length);
          ////console.log("search string :" +Office.context.document.settings.get("curhdr") );
         var res= mysections.items[ii].getHeader("Primary").search(currentheader);

         ////console.log("search started");
         context.load(res);
              return context.sync().then(function ()
           {
             ////console.log("res ctx loaded");
             ////console.log("search found: " + res.items.length);
             ////console.log("curr header1 :"+currentheader);
             ////console.log("curr header 2: "+Office.context.document.settings.get("currentheader"));
             ////console.log("new header " +newheader);
             ////console.log("sense name: "+Office.context.document.settings.get("sensename"));
             for(var x=0;x<res.items.length;x++)
              {
               ////console.log("search : "+res.items.length);
               ////console.log("new header :"+newheader);
               ////console.log("current header: "+Office.context.document.settings.get("currentheader"));
               ////console.log('<p style="font-family: verdana;text-align:center;color: '+Office.context.document.settings.get("headercolor")+'" >'+newheader+'</p>');
                res.items[x].insertHtml('<p style="font-family: verdana;text-align:center;color: '+Office.context.document.settings.get("headercolor")+'" >'+newheader+'</p>',"Replace");
   //             ////console.log('<p style="font-family: verdana;color: '+heeadercolor+'" >'+newheader+'</p>');
                currentheader=newheader;
             
                ////console.log("after chnage curr header: "+ currentheader);
                ////console.log("after change new hder : "+ newheader);
                Office.context.document.settings.set("currentheader",currentheader);
              Office.context.document.settings.saveAsync(function(asyncResult){});   
              }
              
            insertproperty("VeriketScope",Office.context.document.settings.get("scopename"));
            insertproperty("VeriketClassification",Office.context.document.settings.get("classname"));
            
            insertproperty("VeriketSensitivity",Office.context.document.settings.get("sensename"));
            readscope();
     //           ////console.log("after change current header: "+currentheader);
           })
        }
     
       
      })
 
      
      

    }

   function cokgizliheader()
    {
      ////console.log("çok gizzli clicked");
      getJsonData().then(function(){
        ////console.log("çok gizli inside jsonget");
      //Office.context.document.setSelectedDataAsync("json alındı ulan"+vketJson);
        
       // ////console.log(Office.context.document.settings.get("currentheader")); 
        //Office.context.document.setSelectedDataAsync("json alındı ulan2 "+Office.context.document.settings.get("vket"));
   
      Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Çok Gizli");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(237,28,36)");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
   ////console.log("çok gizli bef add header");
      addHeader();
      })
       
    


    }
   function gizliheader()
   {
    ////console.log(" gizzli clicked");

    getJsonData().then(function(){

      ////console.log("gizli indifr getjson");
    
    
      Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Gizli");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(256,201,14)");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      ////console.log("befare add header gizli");

      addHeader();
      })

   }
   function dahiliheader()
   {
    ////console.log("çdahili clicked");

    getJsonData().then(function(){
      ////console.log("dahili indifr getjson");
   //   newheader = 'Veriket | Dahili';
    //  heeadercolor= "rgb(0,159,231)";
      Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Dahili");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(0,159,231)");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      ////console.log("befare add header");
      addHeader();
      })
   }
   function genelheader()
   {
    ////console.log("genel clicked");

    getJsonData().then(function(){
      
    //  newheader = "Veriket | Genel";
     // heeadercolor = "rgb(195,195,195)";
      Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Genel");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(195,195,195)");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      addHeader();
      })

   }
   function checkclassnotselected()
   {
     if((Office.context.document.settings.get("currentscopeprop")==null) && (Office.context.document.settings.get("currentclassprop")==null))
     {
      Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Genel");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(195,195,195)");
    
      Office.context.document.settings.saveAsync(function(asyncResult){});
   
     }
   }
   //**sensitivity functions ***/////
   function kvicermezheader()
   {
     checkclassnotselected();
     getJsonData().then(function(){
      Office.context.document.settings.set("sensename","Kişisel Veri İçermez");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      addHeader();


    })
   }

   function kvicerirheader()
   {
    checkclassnotselected();

     getJsonData().then(function(){
      Office.context.document.settings.set("sensename","Kişisel Veri İçerir");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      addHeader();


    })
   }
   function onkvicerirheader()
   {
    checkclassnotselected();
 
     getJsonData().then(function(){
      Office.context.document.settings.set("sensename","Özel Nitelikli Kişisel Veri İçerir");
      Office.context.document.settings.saveAsync(function(asyncResult){});   
      addHeader();


    })
   }   
//*****read props****///
async function readscope()
{
 await Word.run(async (context) =>
  {
    let properties = context.document.properties.customProperties;
 
   context.load(properties);
     return context.sync()
     .then(function()
 {
   properties.load("key","type","value");
   //////console.log("prop length : "+ properties.items.length);
   for(var i=0;i<properties.items.length;i++)
     {
       if(properties.items[i].key=="VeriketScope")
        {

          Office.context.document.settings.set("currentscopeprop",returnscopename(properties.items[i].value));
          Office.context.document.settings.saveAsync(function(asyncResult){});   
          ////console.log("scope prop :" +Office.context.document.settings.get("currentscopeprop" ));
    
        }
       else if(properties.items[i].key=="VeriketClassification")
        {
          Office.context.document.settings.set("currentclassprop",returnclassname(properties.items[i].value));
          Office.context.document.settings.saveAsync(function(asyncResult){});   
          ////console.log("scope prop :" +Office.context.document.settings.get("currentclassprop" ));

        }
        else if(properties.items[i].key=="VeriketSensitivity")
        {
          Office.context.document.settings.set("currentsenseprop",returnsensename(properties.items[i].value));
          //Office.context.document.settings.set("sensename",properties.items[i].value);
         Office.context.document.settings.saveAsync(function(asyncResult){});   
         ////console.log("scope prop :" +Office.context.document.settings.get("currentsenseprop" ));

        }
     }
 })
  })
  
}
/////********add props**********/////////
async function insertproperty(PropName,PropValue)
{
  await Word.run(async (context) => {

                         if(PropName=="VeriketScope")
                         {
                           context.document.properties.customProperties.add(PropName,  returnscopeguid(PropValue));
                         } else if(PropName=="VeriketClassification")
                         {
                          context.document.properties.customProperties.add(PropName,  returnclassid(PropValue));

                         } else if (PropName=="VeriketSensitivity")
                         {
                          context.document.properties.customProperties.add(PropName,  returnsenseid(PropValue));

                         }

                    await context.sync();

                    ////console.log("Property added");
                    ////console.log(PropName+":"+PropValue);
                });
}


   //*******read from json ******/////

  function returnscopename(scopeid)
  {
    let myjson = Office.context.document.settings.get("vket");
    const data = myjson["Scopes"];
    for(var x=0;x<data.length;x++)
    {
      if(data[x].Id==scopeid)
       {
         break;
       }
    }
      ////console.log("id: "+scopeid+"= "+data[x].Name);
      scopeindex=x;
      Office.context.document.settings.set("scopeindex",x);
      Office.context.document.settings.saveAsync(function(asyncResult){});
      return data[x].Name;
  }

  function returnclassname(classid)
  {
    ////console.log("si :"+scopeindex);
    let myjson = Office.context.document.settings.get("vket");
    const data = myjson["Scopes"][Office.context.document.settings.get("scopeindex")]["Classifications"];
    for(var xx=0;xx<data.length;xx++)
      {
        if(data[xx].Id==classid)
         {
           break;
         }
      }
      ////console.log("classid :"+classid+" = "+data[xx].Name);
      return data[xx].Name;
  }
   function returnsensename(senseid)
   {
    let myjson = Office.context.document.settings.get("vket");
    const data = myjson["Sensitivities"];
    for(var yy=0;yy<data.length;yy++)
    {
      if(data[yy].Id==senseid)
       {
         break;
       }
    }
    ////console.log("senseid: "+senseid+" ="+data[yy].Name);
     return data[yy].Name;
   }



   function returnscopeguid(lscopnename)
   {
     
     let myjson = Office.context.document.settings.get("vket");
     ////console.log(myjson);
     const data=myjson["Scopes"];
     for(var i=0;i<data.length;i++)
     {
       if(data[i].Name==lscopnename)
       {
         break;
       }
     }
     ////console.log(data.length+" "+i+" "+data[0].Id+data[i].Name+" "+data[i].Description);
     scopeidindex=i;
     ////console.log(data[i].Id);
     return data[i].Id;
   }
  
    function returnclassid(lclassname)
    {
    let myjson = Office.context.document.settings.get("vket");
    const data = myjson["Scopes"][scopeidindex]["Classifications"];
    for(var z=0;z<data.length;z++)
     {
       if(data[z].Name==lclassname)
        {
          Office.context.document.settings.set("currentclassscore",data[z].ClassificationScore);
          Office.context.document.settings.saveAsync(function(asyncResult){});   
          break;
        }
     }
     ////console.log("class name: "+lclassname+" id: "+data[z].Id);
     return data[z].Id;
    }

    function returnsenseid(lsensename)
    {
    let myjson = Office.context.document.settings.get("vket");
    const data = myjson["Sensitivities"];
    for(var t=0;t<data.length;t++)
     {
       if(data[t].Name==lsensename)
        {  
          Office.context.document.settings.set("currentsensescore",data[t].SensitivityScore);
          Office.context.document.settings.saveAsync(function(asyncResult){});  
          break;
        }
     }

     ////console.log("sense name: "+lsensename+" =:"+data[t].Id);
     return data[t].Id;
    }
    function returnclassscore(lclassname)
    {
      let myjson = Office.context.document.settings.get("vket");
      if(Office.context.document.settings.get("scopeindex") == null)
       {
        Office.context.document.settings.set("scopeindex",scopeindex);
        Office.context.document.settings.saveAsync(function(asyncResult){});


       }
      ////console.log("scope index :"+Office.context.document.settings.get("scopeindex"));

      const data = myjson["Scopes"][Office.context.document.settings.get("scopeindex")]["Classifications"];
      for(let x=0;x<data.length;x++)
      {
        if(data[x].Name == lclassname)
         {
           return data[x].ClassificationScore;
           break;
         }
      }
    }
    ///////////// RULE LISTING //////////////
   async function listRules()
    {
      ////console.log("lr start");
    await  getJsonData();
   
    ////console.log("//////////REGEX STARTED//////////////////")
       let myjson = Office.context.document.settings.get("vket");
       const data = myjson["Policies"];
     //  ////console.log(data.length);
     var kkartipin='^*\\b(?i)((PIN)|(KartSifresi)|(KartSifre)|(Sifre)|(SÄ±fre)|(Åifre)|(Parola)|(PIN)|(pin )|(pÄ±n))((\\s)*)((:)*)((=)*)((;)*)((,)*)((:)*)(\\d{4})\\b';
    var kartguvenlikkodu= '^*\\b(?i)((CVV)|(CVC)|(CID)|(CiD)|(CV2))((\\s)*)((:)*)((=)*)((;)*)((,)*)((\\s)*)((:)*)(\\d{3})\\b';
    var kkartiskt= '^*\\b(?i)((VALID)|(Valid)|(ValÄ±d)|(THRU)|(SonKullanma)|(Son Kullanma)|(Son Kullanma Tarihi)|(Son Kullanma TarÄ±hÄ±)|(GeÃ§erlilik Tarihi)|(Gecerlilik Tarihi)|(GecerlÄ±lÄ±k TarÄ±hÄ±)|(GeÃ§erlÄ±lÄ±k TarÄ±hÄ±))((\\s)*)((:)*)((=)*)((;)*)((,)*)((\\s)*)((:)*)(\\d{2})((\\\\)|(\\/))(\\d{2})\\b';
    var plakak= '^(0[1-9]|[1-7][0-9]|8[01])((\\s)*)(([A-Za-z])(\\d{4,5})|([A-Za-z]{2})(\\d{3,4})|([A-Za-z]{3})((\\s)*)(\\d{2,3}))$';
    var heskodu ='^*\\b([A-Z]{1}[1-9]{1}[A-Z]{1}[1-9]{1})-[1-9]{4}-[1-9]{2}\\b';
    var serino= '\\b((SERÄ°)|(Seri)|(SERÄ° NO)|(Seri No))((\\s)*)((:)*)((\\s)*)([A-Z][0-9]{2}[A-Z][0-9]{5})\\b|\\b((SERÄ°)|(Seri)|(Seri No)|(SERÄ° NO))((\\s)*)((:)*)((\\s)*)([A-Z][0-9]{2})\\b';
    var iprule= '^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$.*';
    var pinpukrule= '^*(?i)((PIN)|(PÄ°N)|(Pin)|(PÄ±n)|(pin )|(pÄ±n)|(PUK)|(Puk)|(puk ))((\\s)*)((:)*)((=)*)((;)*)((,)*)((\\s)*)((:)*)(\\d{3})';
    var imeirule= '^[0-9]{15}\\b(((\\s)*)(,*((\\s)*)[0-9]{15})*$)*';
     //functional regexes
    var kkartivalidate = '^*\\b([0-9][.])?(([0-9]{16})|(([0-9]{4})[-]([0-9]{4})[-]([0-9]{4})[-]([0-9]{4})))\\b';
    var iban ='\\bTR[0-9]{2}\\s?([0-9]{4}\\s?){1}([0-9]{1})([0-9]{3}\\s?)([0-9]{4}\\s?){3}([0-9]{2})\\s?\\b';
    var vergino='^*\\s(([+9]*[0]*(\\d{3})-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|((\\d{3})-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|(\(*[0]*(\\d{3})\)-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|([0]*\((\\d{3})\)-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2})))\\b';
    var vno ='^*\\s(([+9]*[0]*(\\d{3})-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|((\\d{3})-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|(\\(*[0]*(\\d{3})\\)-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2}))|([0]*\\((\\d{3})\\)-*\\s*(\\d{3})-*\\s*(\\d{2})-*\\s*(\\d{2})))\\b';
    var tcno = '^*\\b([0-9][.])?([1-9]{1}[0-9]{9}[02468]{1})\\b';


    




    //   ////console.log(regxarray);

// ////console.log(regxarray);
 /*
  var plaka ="sdfdsfdsf 35 AA 2512dsfdsfdsfspin:342tgtytyv7t7-1572-16ddcrecre";
  var  v;
var val = plaka;
v = val.replace(/\s+/g, '').toUpperCase();
////console.log(v);
const regexarray=[/(0[1-9]|[1-7][0-9]|8[01])((\s)*)(([A-Za-z])(\d{4,5})|([A-Za-z]{2})(\d{3,4})|([A-Za-z]{3})((\s)*)(\d{2,3}))/g,
/((PIN)|(PÄ°N)|(Pin)|(PÄ±n)|(pin)|(pÄ±n)|(PUK)|(PİN)|(Puk)|(puk))((\s)*)((:)*)((=)*)((;)*)((,)*)((\s)*)((:)*)(\d{3})/g,
/([A-Z]{1}[1-9]{1}[A-Z]{1}[1-9]{1})-[1-9]{4}-[1-9]{2}/g];

 regexarray.forEach(function(value,index,array)
 {
   const result=v.match(value);
   ////console.log("res:"+result);
   ////console.log(value);
 })

*/
 
  await Word.run(async(ctx)=>
  {
    var docbody=ctx.document.body;
    docbody.load();
    await ctx.sync();
    ////console.log("SEARCH STARTED");
    await listDictionaries(docbody);
    ////console.log("SEARCH ENDED");
    var docbodyx=(docbody.text).replace(/\s+/g, '').toUpperCase();
   // var docbodyx=(docbody.text)
    //var docbodyx = docbody.text;
    ////console.log("body : "+docbodyx);

    for(var qq=0;qq<data.length;qq++)
       {
         
         const rules = data[qq]["Rules"];
       //  ////console.log(rules.length);
         for(var rr=0;rr<rules.length;rr++)
         {
           var subrules=rules[rr]["Rule"]["Conditions"][0]["Values"][0];
           if(!(subrules == null || subrules== "content"))
           {
             if(atob(subrules)==kkartipin)
             {
             
               subrules=/((PIN)|(KartSifresi)|(KartSifre)|(Sifre)|(Şifre)|(sifre)|(şifre)|(ŞİFRE)|(şifre )|(Parola)|(PIN)|(pin)|(PİN))((\s)*)((:)*)((=)*)((;)*)((,)*)((:)*)(\d{4})/g;
               //regxarray.push(subrules);
             } else if(atob(subrules)==kartguvenlikkodu)
             {

               subrules=/((CVV)|(CVC)|(CID)|(CiD)|(CV2))((\s)*)((:)*)((=)*)((;)*)((,)*)((\s)*)((:)*)(\d{3})/g;
               //regxarray.push(subrules);
             } else if(atob(subrules)==kkartiskt)
             {

               subrules=/((VALID)|(THRU)|(SONKULLANMATARİHİ)|(GEÇERLİLİKTARİHİ)|(SONKULLANMATARIHI)|(GECERLILIKTARIHI)|)((\s)*)((:)*)((=)*)((;)*)((,)*)((\s)*)((:)*)(\d{2})((\\)|(\/))(\d{2})/g;
               //regxarray.push(subrules);
             } else if(atob(subrules)==plakak)
             {

               subrules=/(0[1-9]|[1-7][0-9]|8[01])((\s)*)(([A-Za-z])(\d{4,5})|([A-Za-z]{2})(\d{3,4})|([A-Za-z]{3})((\s)*)(\d{2,3}))/gi;
               //regxarray.push(subrules);
             } 
             else if(atob(subrules)==heskodu)
             {

               subrules=/([A-Z]{1}[1-9]{1}[A-Z]{1}[1-9]{1})-[1-9]{4}-[1-9]{2}/g;
               //regxarray.push(subrules);
             } 
             else if(atob(subrules)==serino)
             {

               subrules=/((SERİ)|(SERINO)|(SERI)|(SERİNO))((\s)*)((:)*)((\s)*)([A-Z][0-9]{2}[A-Z][0-9]{5})\b|((SERİ)|(SERI)|(SERİNO)|(SERINO))((\s)*)((:)*)((\s)*)([A-Z][0-9]{2})/g;
               //regxarray.push(subrules);
             } 
             else if(atob(subrules)==iprule)
             {

               subrules=/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/g;
               //regxarray.push(subrules);
             } 
             else if(atob(subrules)==pinpukrule)
             {

               subrules=/((PIN)|(PİN)|(PUK))((\s)*)((:)*)((=)*)((;)*)((,)*)((\s)*)((:)*)(\d{4})/g;
               //regxarray.push(subrules);
             } 
             else if(atob(subrules)==imeirule)
             {

               subrules=/[0-9]{15}/g;
               //regxarray.push(subrules);
             } 
             
             
             else
             {
              //regxarray.push(atob(subrules));
              subrules=atob(subrules);
             }

           
             const result=docbodyx.match(subrules);
             if(myjson["Policies"][qq].Name == "Imei Numrası Politikası" && result != null)
             {
               ////console.log("imei kontrol//////////////////////");
               ValidateImei(result,myjson["Policies"][qq].Name,myjson["Policies"][qq]["Rules"][rr]["Rule"].Name,myjson["Policies"][qq].ClassificationScore,myjson["Policies"][qq].SensitivityScore);
             }else
             {
              if((result != null) )
             {
              ////console.log("res:doc: "+result);
              ////console.log("index: "+qq+"/"+rr+" value:"+subrules);
              ////console.log("Politika : "+myjson["Policies"][qq].Name);
              ////console.log("Kural :"+myjson["Policies"][qq]["Rules"][rr]["Rule"].Name);
              //add to result arrays
              //1. politika
              /*
              if(!poitika.includes(myjson["Policies"][qq].Name))
               {
                 poitika.push(myjson["Policies"][qq].Name);
                 ////console.log("politika eklendi :" +myjson["Policies"][qq].Name);
               }
               if(!kural.includes(myjson["Policies"][qq]["Rules"][rr]["Rule"].Name))
               {
                      kural.push(myjson["Policies"][qq]["Rules"][rr]["Rule"].Name);
                      ////console.log("kural eklendi :" + myjson["Policies"][qq]["Rules"][rr]["Rule"].Name);
               }
               */
               
               checkkeyword(result,myjson["Policies"][qq].Name,myjson["Policies"][qq]["Rules"][rr]["Rule"].Name);
               checkScores(myjson["Policies"][qq].ClassificationScore,myjson["Policies"][qq].SensitivityScore);
/*
               for(let x=0;x<result.length;x++)
               {
                 
                if(!keywords.includes(result[x]))
               {
                 keywords.push(result[x]);
                 ////console.log("keyword eklendi :" + result[x]);
    
               }
               }
    */
             }

           

               

              
                
              ////console.log("//////////");
             }
  
             
          //   ////console.log(atob(subrules));

            } 
           // ////console.log("Policy :"+data[qq].Name);
          //  ////console.log(rules[rr]["Rule"].Name);
           //////console.log(atob(subrules));

           
          //   ////console.log("Policy :"+qq+ " Rule :"+rr);

     
         }
         
       } //tegex loop ends
       //functional loop

        ////console.log("func regex start");
    for(var aa=0;aa<data.length;aa++)

   {
        const rules=data[aa]["Rules"];
        for(var ww=0;ww<rules.length;ww++)
   {

     const  fcontrols=rules[ww]["Rule"]["Conditions"][0]["FunctionalControls"];
  
     if(fcontrols.length > 0)
      {
        for(var ff=0;ff<fcontrols.length;ff++)
         {

           
           var fnc = fcontrols[ff]["Functions"][0].Value;
        //   ////console.log(atob(fnc));
         //  ////console.log(fcontrols[ff]["Functions"][0].Name);
        //   ////console.log("phone check :"+  phoneUtil.isValidNumberForRegion(phoneUtil.parse('2123655545', 'TR'), 'TR'));
         //  ////console.log("iban check: "+validator.isIBAN("GD4543607960343307"));
    
           if(atob(fnc)==kkartivalidate)
             {
            //  ////console.log("func name: "+fcontrols[ff]["Functions"][0].Name );
          //    ////console.log("validate:"+window[fcontrols[ff]["Functions"][0].Name](4543607960343307));
          
               fnc=/([0-9][.])?(([0-9]{16})|(([0-9]{4})[-]([0-9]{4})[-]([0-9]{4})[-]([0-9]{4})))/g;
               funcindex=ff;
               
              } else if (atob(fnc)==iban)
              {
              //  ////console.log("func name: "+fcontrols[ff]["Functions"][0].Name );
                fnc =/([A-Z]{2}[ \-]?[0-9]{2})(?=(?:[ \-]?[A-Z0-9]){9,30}$)((?:[ \-]?[A-Z0-9]{3,5}){2,7})([ \-]?[A-Z0-9]{1,3})?/mg;
               funcindex=ff;

              } else if (atob(fnc)==vno && fcontrols[ff]["Functions"][0].Name =="ValidateTaxNumber")
              {
                //////console.log("vergi no");
               // ////console.log("fnc name:"+fcontrols[ff]["Functions"][0].Name );
                fnc = /\s(([+9]*[0]*(\d{3})-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|((\d{3})-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|(\(*[0]*(\d{3})\)-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|([0]*\((\d{3})\)-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2})))\b/mg;
               funcindex=ff;

              } else if (atob(fnc)==tcno)
              {
               // ////console.log("fnc name:"+fcontrols[ff]["Functions"][0].Name );
                fnc = /([0-9][.])?([1-9]{1}[0-9]{9}[02468]{1})/g;
               funcindex=ff;

              } 
              else if (atob(fnc)==vno && fcontrols[ff]["Functions"][0].Name =="ValidatePhone")
              {
                //////console.log("tel no");
                //////console.log("fnc name:"+fcontrols[ff]["Functions"][0].Name );
                fnc = /(([+9]*[0]*(\d{3})-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|((\d{3})-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|(\(*[0]*(\d{3})\)-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2}))|([0]*\((\d{3})\)-*\s*(\d{3})-*\s*(\d{2})-*\s*(\d{2})))((\s)*)/g;

               funcindex=ff;

              } 
              
              const result=docbodyx.match(fnc);
                 if(!(result == null))
                  {
                    ////console.log("index: "+aa+"-"+ww+"-"+ff);
                   // ////console.log(fcontrols[ff]);
                    ////console.log("Politika :"+data[aa].Name);
                    ////console.log("Kural :"+rules[ww]["Rule"].Name);
                    ////console.log("Class score : "+data[aa].ClassificationScore);
                    ////console.log("sense score :"+ data[aa].SensitivityScore);
                    //////console.log(fcontrols[ff]["Functions"][0].Name);
                    
                    ////console.log("func name: "+fcontrols[ff]["Functions"][0].Name);

                    ////console.log(result);
              
                   // ////console.log("from body:" +window[fcontrols[funcindex]["Functions"][0].Name](result,data[aa].Name,rules[ww].Name));
                   
                   window[fcontrols[funcindex]["Functions"][0].Name](result,data[aa].Name,rules[ww]["Rule"].Name,data[aa].ClassificationScore,data[aa].SensitivityScore);
                    ////console.log("/////////////");
                  }
         }
         
      }
   

    
    }
}
    //     listDictionaries();
    
   
  })

   ////console.log("run finished");
   ////console.log("politika :" + poitika);
   //save politika
      Office.context.document.settings.set("politika",poitika);
    //  Office.context.document.settings.saveAsync(function(asyncResult){});   
          
   ////console.log("kural :" + kural);
      Office.context.document.settings.set("kural",kural);
   //   Office.context.document.settings.saveAsync(function(asyncResult){});   
   ////console.log("keywrds :" + keywords);
   Office.context.document.settings.set("keywords",keywords);
      Office.context.document.settings.saveAsync(function(asyncResult){});   
   ////console.log("class scores: "+classscore);
   ////console.log("sense scores :"+sensescore);   
   Office.context.document.settings.set("classscore",classscore);
   Office.context.document.settings.set("sensescore",sensescore);

   Office.context.document.settings.saveAsync(function(asyncResult){}); 
    }
   ////////////DICTIONARIES//////////
   async function listDictionaries(bodytext)
   {
    await  getJsonData();
       let myjson = Office.context.document.settings.get("vket");
       ////console.log(bodytext.text);
       const data = myjson["Policies"];
    //   ////console.log(data);
       for(var aa=0;aa<data.length;aa++)

       {
         const rules=data[aa]["Rules"];
         for(var ww=0;ww<rules.length;ww++)
          {
            var original = rules[ww]["Rule"]["Conditions"][0]["Dictionary"];
       //     var dicts=JSON.stringify(rules[ww]["Rule"]["Conditions"][0]["Dictionary"]);
        //    var evaled = eval((rules[ww]["Rule"]["Conditions"][0]["Dictionary"]));
         //    ////console.log((dicts));
          //   ////console.log((evaled));
           var keyx=Object.keys(original);
        
           for(let lx=0;lx<keyx.length;lx++)
           {
            // ////console.log("Politika :"+data[aa].Name);
           //  ////console.log("Kural :"+rules[ww]["Rule"].Name);
             var vals= Object.values(original);
              for (let ly=0;ly<vals.length;ly++)
               {
                 //////console.log(keyx[0]);
                // ////console.log(vals[ly].length);
                 for(let xx=0;xx<vals[ly].length;xx++)
                  {
                    //term to serach : vals[ly][xx])
                   // ////console.log(vals[ly][xx]);
                    var rex=new RegExp(vals[ly][xx],'gmi');
                //  var rex = /(deneyim)/gi;
                  //  ////console.log("regex :"+rex);
                    const result = (bodytext.text).match(rex);
                    if(!(result == null))
                    {
                    ////console.log("Result:"+result);
                    ////console.log("Politika :"+data[aa].Name);
                    ////console.log("Kural :"+rules[ww]["Rule"].Name);
                    ////console.log("Class Score: "+data[aa].ClassificationScore);
                    ////console.log("Sense score: "+data[aa].SensitivityScore);
                    checkkeyword(result,data[aa].Name,rules[ww]["Rule"].Name);

                    }
                  }
                  ////console.log("//////////////");
               }
           }
          
          // ////console.log(Object.keys(original));
          // ////console.log((Object.values(original)));
             
            
      
          

           
           }
       }
   
      }

   function returnclassnamefromscore(lscopeindex,lclasscore)
   {
     const data = vketJson["Scopes"][lscopeindex]["Classifications"];
     for(let x=0;x<data.length;x++)
     {
       if(data[x].ClassificationScore == lclasscore)
        {
          return data[x].Name;
          break;
        }
     }
   }
   function returnsensenamefromscore(lsensescoremustbe)
   {
     const data = vketJson["Sensitivities"];
     for(let x=0;x<data.length;x++)
     {
       if(data[x].SensitivityScore == lsensescoremustbe)
        {

           return data[x].Name;
           break;
        }
     }
   }
////AUTO SINIFLANIRMA////////////////
async function autoclassification()
{
  ////console.log("//auto started///////////");
  await listRules();
  await checkprops();
  ////console.log("////auto ended");
  logconsole("Politika",Office.context.document.settings.get("politika"));
  logconsole("Kural",Office.context.document.settings.get("kural"));
  logconsole("keywords",Office.context.document.settings.get("keywords"));
  logconsole("scopename",Office.context.document.settings.get("scopename"));
  logconsole("classname",(Office.context.document.settings.get("classname" )));
  logconsole("sensename",Office.context.document.settings.get("sensename"));
  logconsole("current class score",returnclassscore(Office.context.document.settings.get("classname" )));
  logconsole("current sense score",Office.context.document.settings.get("currentsensescore"));
  logconsole("scope index",Office.context.document.settings.get("scopeindex"));
  
  let lclasscoremustbe = Math.max(... Office.context.document.settings.get("classscore"));
  let lsensescoremustbe = Math.max(... Office.context.document.settings.get("sensescore"));
  
  logconsole("class score must be",lclasscoremustbe);
  logconsole("sense score must be",lsensescoremustbe);

  
if(lclasscoremustbe > returnclassscore(Office.context.document.settings.get("classname" )))
{
  Office.context.document.settings.set("classname",returnclassnamefromscore(Office.context.document.settings.get("scopeindex"),lclasscoremustbe));
  Office.context.document.settings.saveAsync(function(asyncResult){});

}
Office.context.document.settings.set("headercolor",returncolorfromclassname(Office.context.document.settings.get("classname")));
 Office.context.document.settings.saveAsync(function(asyncResult){});    

if(lsensescoremustbe > Office.context.document.settings.get("currentsensescore"))
{
  ////console.log("sense score düşük.");
  Office.context.document.settings.set("sensename",returnsensenamefromscore(lsensescoremustbe));
  Office.context.document.settings.saveAsync(function(asyncResult){});

}
//Office.context.document.settings.saveAsync(function(asyncResult){});

await addHeader();
  


}
function logconsole(baslik,data)
{
  ////console.log(baslik + ": "+data);
}

      /////////show dialog ////////////////////////////////////////////////////////////////////////////////////////////


function waitandshowdialog()
{
  setTimeout(() => {
    ShowDialog();
  }, 1000);
}
 async function ShowDialog()
 {
  await listRules();
  //check props first
  await checkprops();
   ////console.log("show dialog clicked");
   Office.context.ui.displayDialogAsync('https://localhost:3000/Dialog.html',{height:60,width:30,displayInIframe:true},
   
     function (asyncResult)
     {
       if((asyncResult.status=="succeeded"))
       {
         ////console.log("status :" + asyncResult.status);
        dialog =asyncResult.value;
       
 
       dialog.addEventHandler(Office.EventType.DialogMessageReceived, messageHandler);
       dialog.addEventHandler(Office.EventType.DialogEventReceived, eventHandler);
       }
       
     }
     
     
     );
   
 }
 async function checkprops()
 {
   if( (Office.context.document.settings.get("currentscopeprop")==null) && (Office.context.document.settings.get("currentclassprop")==null) && (Office.context.document.settings.get("currentsenseprop")==null))
   {
     ////console.log("all is null");
     await getJsonData();
     ////console.log("json :"+ vketJson);
     Office.context.document.settings.set("scopename","Veriket");
      Office.context.document.settings.set("classname","Genel");
    //todo get color from json data
      Office.context.document.settings.set("headercolor","rgb(195,195,195)");
    
     await Office.context.document.settings.saveAsync(function(asyncResult){});
     await addHeader();



   } else
   {
     //await readscope();
   }
 }
 
 function returncolorfromclassname(lclassname)
 {
   const data = vketJson["Scopes"][Office.context.document.settings.get("scopeindex")]["Classifications"];
   for(let x=0;x<data.length;x++)
   {
     if(data[x].Name == lclassname)
      {
        return data[x].Color;
        break;
      }
   }

 }
 
 async function messageHandler(arg)
  {
    var messagefromdialog = JSON.parse(arg.message);
   // ////console.log("Message from dialog: "+messagefromdialog.messageType+ " data: "+messagefromdialog.data);
    switch(messagefromdialog.messageType)
    {
      case "Ready":
        {
       ////console.log("child is ready");   
       if(Office.context.document.settings.get("vket")==null)
       {
         ////console.log("vket is null");
        await getJsonData();
    

       sendmessagectochild("vket Json",Office.context.document.settings.get("vket"));

       } else
       {
         sendmessagectochild("vket Json",Office.context.document.settings.get("vket"));
       }
  

      sendmessagectochild("Politika",Office.context.document.settings.get("politika"));

      sendmessagectochild("Kural",Office.context.document.settings.get("kural"));

      sendmessagectochild("Keywords",Office.context.document.settings.get("keywords"));

      sendmessagectochild("Scope",Office.context.document.settings.get("scopename"));

      sendmessagectochild("Class",(Office.context.document.settings.get("classname" )));
 
      sendmessagectochild("Sense",Office.context.document.settings.get("sensename" ))
  
      sendmessagectochild("ClassScore", returnclassscore(Office.context.document.settings.get("classname" )));
        
      sendmessagectochild("SenseScore", Office.context.document.settings.get("currentsensescore"));

      sendmessagectochild("ScopeIndex",Office.context.document.settings.get("scopeindex"));

      //send max of class and sense arrays
   
      sendmessagectochild("ClassMustbe",Math.max(... Office.context.document.settings.get("classscore")));
      sendmessagectochild("SenseMustbe",Math.max(... Office.context.document.settings.get("sensescore")));
      break;
        }
      case "scope Index":
        {
          ////console.log("Alınan scope index: "+messagefromdialog.data);
          //save scopeindex
          Office.context.document.settings.set("scopeindex",messagefromdialog.data);
          Office.context.document.settings.saveAsync(function(asyncResult){});
          break;
        }
      case "classguid":
        {
          ////console.log("new class guid :"+messagefromdialog.data);
          //save class name from class guid
          Office.context.document.settings.set("classname", returnclassname(messagefromdialog.data));
          Office.context.document.settings.saveAsync(function(asyncResult){});
          ////console.log("class name from children :"+Office.context.document.settings.get("classname"));
          //header color from class name
          Office.context.document.settings.set("headercolor",returncolorfromclassname(Office.context.document.settings.get("classname")));
          Office.context.document.settings.saveAsync(function(asyncResult){});             
          ////console.log("color from children :"+ Office.context.document.settings.get("headercolor"));
          break;
        }
      case "senseguid":
        {
          ////console.log("new sense guid :"+messagefromdialog.data);
          Office.context.document.settings.set("sensename",returnsensename(messagefromdialog.data));
          Office.context.document.settings.saveAsync(function(asyncResult){});
          ////console.log("sense name from children :"+  Office.context.document.settings.get("sensename"));
         

          break;
        }
      case "close":
        {
          dialog.close();
          addHeader();
          break;
        }
    }

  }
  function sendmessagectochild(msgtype,val)
  {
      var msg = JSON.stringify({messageType:msgtype,data:val});
      dialog.messageChild(msg);
      if(msgtype != "vket Json")
      {
        ////console.log("child a msg yollandı :"+ msg);

      }
  }

 function eventHandler(arg) {

// In addition to general system errors, there are 2 specific errors 
// and one event that you can handle individually.
switch (arg.error) {
    case 12002:
        ////console.log("Cannot load URL, no such page or bad URL syntax.");
        break;
    case 12003:
    ////console.log("HTTPS is required.");
        break;
    case 12006:
        // The dialog was closed, typically because the user the pressed X button.
        ////console.log("Dialog closed by user");
        addHeader();
        break;
    default:
    ////console.log("Undefined error in dialog window");
        break;
}
}



  function checkkeyword(lresult,lpolitika,lkural)
  {
    for(let x=0;x<lresult.length;x++)
    {
      if(!(keywords.includes(lresult[x])))
       {
         keywords.push(lresult[x]);
         //////console.log("keyword eklendi :"+lresult[x]);
       }
    }
     checkpolitika(lpolitika);
     checkkural(lkural);
  }

  function checkpolitika(lpolitika)
  {
    if(!poitika.includes(lpolitika))
    {
      ////console.log("politika eklendi :" + lpolitika);
      poitika.push(lpolitika);
    }
  }
  function checkkural(lkural)
  {
  if(!kural.includes(lkural))
    {
      //////console.log("kural eklendi :" + lkural);
      kural.push(lkural);
    }
  }
  function checkScores(lclasscore,lsensescore)
  {
    if(!(classscore.includes(lclasscore)))
    {
      classscore.push(lclasscore);
      //////console.log("class score eklendi :"+lclasscore);
      ////console.log("class sc array:"+classscore)
    }
    if(!(sensescore.includes(lsensescore)))
    {
      sensescore.push(lsensescore);
      ////console.log("sense score eklendi :"+lsensescore);
    }


  }
  function ValidateImei(lresult,lpolitika,lkural,lclasscore,lsensescore)
  {
    ////console.log("Imei check:"+lresult);
    for(let x=0;x<lresult.length;x++)
    {
      if(validator.isIMEI(lresult[x]))
       {
        //Imei politika manuel
        lpolitika="Kişisel Veri Politikası";
         checkpolitika(lpolitika);
         checkkural(lkural);
         checkScores(lclasscore,lsensescore);

     //    checkkeyword(lresult[x],lpolitika,lkural);
         keywords.push(lresult[x]);
         ////console.log("imei keyword eklendi :"+lresult[x]);
       } else
       {
         ////console.log("imei geçerli değil :"+lresult[x]);
       }
    }
  }


   function ValidateTaxNumber()
   {
     ////console.log("tax nr");
   }
   function ValidateIban(liban,lpolitika,lkural,lclasscore,lsensescore)
   {
    for(let x=0;x<liban.length;x++)
     {
     if (validator.isIBAN(liban[x]))
       {
      // checkkeyword(liban[x],lpolitika,lkural);
       checkpolitika(lpolitika);
       checkkural(lkural);
       checkScores(lclasscore,lsensescore);
       if(!keywords.includes(liban[x]))
        {
          ////console.log("iban eklendi: "+liban[x]);
          keywords.push(liban[x]);
        }
     
       }
         else
       {
         ////console.log("valid iban değil "+liban[x]);
       }
 
     }
   }
    
   function ValidatePhone(phone,lpolitika,lkural,lclasscore,lsensescore)
   {
    
     for(let x=0;x<phone.length;x++)
     {
      if(phone[x][0] == "(" || phone[x][0]=="+" || phone[x][0] == "0")
      { 
       if(phoneUtil.isValidNumberForRegion(phoneUtil.parse(phone[x], 'TR'), 'TR'))
        {
//          checkkeyword(phone[x],lpolitika,lkural);

          checkpolitika(lpolitika);
          checkkural(lkural);
          checkScores(lclasscore,lsensescore);
          if(!keywords.includes(phone[x]))
           {
             ////console.log("tel no eklendi :"+phone[x]);
             ////console.log("kural :"+lkural);
             ////console.log("politika :"+lpolitika);
             keywords.push(phone[x])
           }
           
        }
         else
        {
          ////console.log("valid phone değil "+phone[x]);
        }
      }
     }
     //return lresult;
   }


   function ValidateCreditCard(kartno,lpolitika,lkural,lclasscore,lsensescore) {

  for(let x=0;x<kartno.length;x++)
  {
    if(!(kartno[x] == undefined))
    {
      if(validator.isCreditCard(kartno[x]))
     {
      // checkkeyword(kartno[x],lpolitika,lkural);
       
       checkpolitika(lpolitika);
       checkkural(lkural);
       checkScores(lclasscore,lsensescore);


       if(!keywords.includes(kartno[x]))
        {
          ////console.log("kkartı eklendi :"+kartno[x]);
          keywords.push(kartno[x]);
        }
         
     }
    }
   
  }

  
  };

 
  function ValidateTCKN(TCNO,lpolitika,lkural,lclasscore,lsensescore) {
    if(Array.isArray(TCNO))
    {

      for (let x=0;x<TCNO.length;x++)
      {
        var lresult=true;
        ////console.log("begin tcno :"+lresult);
      var tek = 0,
      cift = 0,
      sonuc = 0,
      TCToplam = 0,
      i = 0;

    if ((TCNO[x].length != 11) || (isNaN(TCNO[x])) || (TCNO[x][0] == 0))
    {
      lresult=false;
      ////console.log("false1");
 
    }   
   

    tek = parseInt(TCNO[x][0]) + parseInt(TCNO[x][2]) + parseInt(TCNO[x][4]) + parseInt(TCNO[x][6]) + parseInt(TCNO[x][8]);
    cift = parseInt(TCNO[x][1]) + parseInt(TCNO[x][3]) + parseInt(TCNO[x][5]) + parseInt(TCNO[x][7]);

    tek = tek * 7;
    sonuc = Math.abs(tek - cift);
    if (sonuc % 10 != TCNO[x][9]) 
    {
      lresult= false;
      ////console.log("false2");

    }

    for (var i = 0; i < 10; i++) {
      TCToplam += parseInt(TCNO[x][i]);
    }

    if (TCToplam % 10 != TCNO[x][10]) 
    {
      lresult= false;
      ////console.log("false3");
    }
    ////console.log("tcno :"+lresult+" "+ TCNO[x]);
    if (lresult)
    { 
      //checkkeyword[TCNO[x],lpolitika,lkural];
      
      checkpolitika(lpolitika);
      checkkural(lkural);
      checkScores(lclasscore,lsensescore);

      if(!keywords.includes(TCNO[x]))
      {
        keywords.push(TCNO[x]);
      }
      
    }
  }
   //return lresult;
  }
  }  
    </script>
</head>
<body>
    Function file body is never displayed.
</body>
</html>